<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Websocket example</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
</head>
<body>
<h1>
    Websockets client
</h1>

<div id="comments">no comments yet</div>
<form id="form">
    <label for="name">Name</label>
    <input id="name" type="text"/>
    <label for="message">Message</label>
    <input id="message" type="text"/>
</form>

<script>
    var noCommentsYet = true;

    // TODO: Turn this address to be generated by a template
    var socket = new WebSocket("ws://localhost:8888/websocket");
    socket.onmessage = function (msg) {
        var comments = document.getElementById("comments");
        if (noCommentsYet) {
            comments.innerHTML = "";
            noCommentsYet = false;
        }
        // msg is a MessageEvent object
        var newElement = document.createElement("p");
        var incomingMessage = JSON.parse(msg.data);

        // Deliberately not escaping HTML... We have to be careful to do this on the server side instead
        newElement.innerHTML = incomingMessage['Sender'] + ": " + incomingMessage['Message'];
        comments.appendChild(newElement);
    };

    function submitMessage(evt) {
        if (evt.keyCode == 13) {
            var message = document.getElementById("message");
            var nameField = document.getElementById("name");
            var text = message.value;
            var name = nameField.value;

            var outgoingMessage = {
                Message: text,
                Sender: name
            };

            socket.send(JSON.stringify(outgoingMessage));
            message.value = "";
            return false
        }
    }

    var messageBox = document.getElementById("message");
    messageBox.onkeypress = submitMessage;
</script>

<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css"
      crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css"
      crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js" crossorigin="anonymous"></script>

</body>
</html>