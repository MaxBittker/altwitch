<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Websocket example</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
</head>
<h1>
    Websockets client
</h1>

<div id="comments">no comments yet</div>
<form id="form">
    <label for="name">Name</label>
    <input id="name" type="text"/>
    <label for="input">Message</label>
    <input id="input" type="text"/>
</form>

<script>
    var noCommentsYet = true;

    // TODO: Turn this address to be generated by a template
    var socket = new WebSocket("ws://localhost:8888/websocket");
    socket.onmessage = function (msg) {
        var comments = document.getElementById("comments");
        if (noCommentsYet) {
            comments.innerHTML = "";
            noCommentsYet = false;
        }
        // msg is a MessageEvent object
        var newElement = document.createElement("p");
        var incomingMessage = JSON.parse(msg.data);
        var textNode = document.createTextNode(incomingMessage['Sender'] + ": " + incomingMessage['Message']);
        newElement.appendChild(textNode);
        comments.appendChild(newElement);
    };

    function submit(evt) {
        if (evt.keyCode == 13) {
            var input = document.getElementById("input");
            var nameField = document.getElementById("name");
            var text = input.value;
            var name = nameField.value;

            var outgoingMessage = {
                Message: text,
                Sender: name
            };

            socket.send(JSON.stringify(outgoingMessage));
            input.value = "";
            return false
        }
    }

    document.onkeypress = submit;
</script>
</html>